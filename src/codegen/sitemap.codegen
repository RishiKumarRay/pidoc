const { posix } = require('path');
const { readFileSync } = require('fs');
const { helpers } = require('../tools/meta');
const { populateCode } = require('../tools/content');
const { getGeneratedFilePath } = require('../tools/utils');

const relative = posix.relative;

module.exports = function () {
  const sitemap = getGeneratedFilePath('sitemap', 'js');
  const content = readFileSync(sitemap, 'utf8');
  const path = relative(__dirname, helpers.filter);

  return `
import filterSitemap from ${JSON.stringify(path)};

${populateCode}

export default filterSitemap(${content});
`;
};
